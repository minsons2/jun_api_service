<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>layui</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../../lib/layui-v2.5.5/css/layui.css" media="all">
    <link rel="stylesheet" href="../../css/public.css" media="all">
    <style>
        body {
            background-color: #ffffff;
        }
    </style>
</head>
<body>
<div class="layui-form layuimini-form">
<div class="layui-btn-container">
 
  <button type="button" class="layui-btn" lay-demotransferactive="reload">重载加载</button>
  <button type="button" class="layui-btn" lay-demotransferactive="getData">保存右侧数据</button>
</div>
 
<div id="test7" class="demo-transfer"></div>
    
</div>
<script src="/layui/layui.all.js"></script>
<script src="/layui-ext/tableSelect.js"></script>
<script src="/js/jquery.js"></script>
<script src="/js/core.util.js"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" media="all"> -->

<link rel="stylesheet" href="/assets/module/admin.css"/>
<script src="/assets/module/admin.js"></script>

<script>
	var data = CoreUtil.getData("pageData");
	console.log("data="+data);
    layui.use(['form','transfer', 'layer', 'util'], function () {
        var $ = layui.$
        ,transfer = layui.transfer
        ,layer = layui.layer
        ,util = layui.util,
        form = layui.form;
      //实例调用
        transfer.render({
          elem: '#test7'
          ,data:  []
          ,id: 'key123' //定义唯一索引
        })
        //批量办法定事件
        util.event('lay-demoTransferActive', {
          getData: function(othis){
            	var getData = transfer.getData('key123'); //获取右侧数据
            	console.log(1111222);
            	var newStr = [];
            	var newStrName = [];
            	$.each(getData, function(index, obj) {
            		newStr.push(obj.value);
            		newStrName.push(obj.title);
                });
                 $.ajax({ 
		    	    type :"post", 
		    	    url : "/public/saveCustomerEditorList/" + data.id,
                     dataType:"json",
		    	    data : {"data":newStr.join(',')} , 
		    	    async :true, 
		    	    success :function(res){
		    	    	var index = layer.alert("提醒：您配置权限的用户已保存成功["+newStrName.join(',')+"]！", {
		                    title: '提交信息'
		                }, function () {
		                    // 关闭弹出层
		                    layer.close(index);
		                    var iframeIndex = parent.layer.getFrameIndex(window.name);
		                    parent.layer.close(iframeIndex);
		                });
		    	    }
		    	}); 
          }
          ,reload:function(){
            //实例重载
            transfer.reload('key123', {
              title: ['全部用户', '有编辑权限的用户']
              ,value: ['admin']
              ,showSearch: true
            })
          }
        });
        $.ajax({ 
    	    type :"post", 
    	    url : "/public/getCustomerEditorList/" + data.id, 
    	    data :{id : 1}, 
    	    async :true, 
    	    success :function(res){
    	    	transfer.reload('key123', {
    	              title: ['全部用户', '有编辑权限的用户']
    	    		  ,data: res.data1
    	              ,value: res.data2
    	              ,showSearch: true
    	            })
    		   	//console.log(JSON.stringify(res));
    	    }
    	}); 
    	
    	
       /*  CoreUtil.sendGet("/public/getCustomerEditorList/" + "1446699467002998785", null, function (res) {
      	  	transfer.reload('key123', {
              title: ['文人', '喜欢的文人']
              ,value: ['2', '5', '9']
              ,showSearch: true
            })
        }); */
        
        //监听提交
        /* form.on('submit(saveBtn)', function (data) {
            var index = layer.alert(JSON.stringify(data.field), {
                title: '最终的提交信息'
            }, function () {

                // 关闭弹出层
                layer.close(index);

                var iframeIndex = parent.layer.getFrameIndex(window.name);
                parent.layer.close(iframeIndex);

            });

            return false;
        }); */

    });
</script>
</body>
</html>